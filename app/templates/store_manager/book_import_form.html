<h1 class="text-center text-primary mb-5">üì¶ NH·∫¨P S√ÅCH V√ÄO KHO</h1>
<!-- Bi·ªÉu m·∫´u nh·∫≠p s√°ch -->
<form id="book-import-form">
    <table class="table table-bordered text-center align-middle">
        <thead class="table-light">
        <tr>
            <th>STT</th>
            <th>T√™n s√°ch</th>
            <th>Th·ªÉ lo·∫°i</th>
            <th>T√°c gi·∫£</th>
            <th>S·ªë l∆∞·ª£ng</th>
            <th>X√≥a</th>
        </tr>
        </thead>
        <tbody id="book-rows">
        <!-- Row 1 -->
        <tr>
            <td>1</td>
            <td>
                <select class="form-select select2-enable" name="book_name" style="width: 100%;" required
                        onchange="fillBookDetails(this)">
                    <option value="">Nh·∫≠p t√™n s√°ch</option>
                    {% for book in books %}
                    <option value="{{ book.id }}" data-genre="{{ book.genres|join(', ') }}"
                            data-author="{{ book.authors|join(', ') }}">{{
                        book.name }}
                    </option>
                    {% endfor %}
                </select>
            </td>
            <td><input type="text" class="form-control" name="genre" placeholder="Nh·∫≠p th·ªÉ lo·∫°i" required readonly>
            </td>
            <td><input type="text" class="form-control" name="author" placeholder="Nh·∫≠p t√°c gi·∫£" required readonly>
            </td>
            <td><input type="number" class="form-control" name="quantity" placeholder="0" min="150" required
                       value="150"></td>
            <td>
                <button type="button" class="btn btn-danger btn-sm" onclick="deleteRow(this)">
                    X√≥a
                </button>
            </td>
        </tr>
        </tbody>
    </table>
    <div class="d-flex justify-content-end">
        <button type="button" class="btn btn-secondary me-2" onclick="addBookInventoryRow()">‚ûï Th√™m d√≤ng</button>
        <button type="submit" class="btn btn-primary">üì• X√°c nh·∫≠n nh·∫≠p s√°ch v√†o kho</button>
    </div>
</form>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    // Th√™m d√≤ng m·ªõi v√†o b·∫£ng nh·∫≠p s√°ch v√†o kho
    function addBookInventoryRow() {
        const tableBody = document.getElementById('book-rows');
        const newRowIndex = tableBody.rows.length + 1;

        // HTML cho d√≤ng m·ªõi
        const newRow = `
    <tr>
                <td>${newRowIndex}</td>
                <td>
                    <select class="form-select select-book" name="book_name" style="width: 100%;" required
                            onchange="fillBookDetails(this)">
                        <option value="">Nh·∫≠p t√™n s√°ch</option>
                        {% for book in books %}
                        <option value="{{ book.id }}" data-genre="{{ book.genres|join(', ') }}" data-author="{{ book.authors|join(', ') }}">{{
                            book.name }}
                        </option>
                        {% endfor %}
                    </select>
                </td>
                <td><input type="text" class="form-control" name="genre" placeholder="Nh·∫≠p th·ªÉ lo·∫°i" required readonly>
                </td>
                <td><input type="text" class="form-control" name="author" placeholder="Nh·∫≠p t√°c gi·∫£" required readonly>
                </td>
                <td><input type="number" class="form-control" name="quantity" placeholder="0" min="150" required
                           value="150"></td>
                <td>
                    <button type="button" class="btn btn-danger btn-sm" onclick="deleteRow(this)">
                        X√≥a
                    </button>
                </td>
            </tr>`;

        // Th√™m d√≤ng m·ªõi v√†o b·∫£ng
        tableBody.insertAdjacentHTML('beforeend', newRow);

        // Kh·ªüi t·∫°o l·∫°i Select2 cho t·∫•t c·∫£ c√°c tr∆∞·ªùng dropdown
        initSelect2();
    }

    // X·ª≠ l√Ω Submit Form
    $('#book-import-form').on('submit', function (e) {
        e.preventDefault();
        let totalBooks = 0;

        $('#book-rows tr').each(function () {
            const quantity = $(this).find('input[name="quantity"]').val() || 0;
            totalBooks += parseInt(quantity);
        });

        if (totalBooks < 150) {
            alert("S·ªë l∆∞·ª£ng s√°ch nh·∫≠p ph·∫£i √≠t nh·∫•t 150 cu·ªën.");
        } else {
            alert("‚úÖ Phi·∫øu nh·∫≠p s√°ch ƒë√£ ƒë∆∞·ª£c x√°c nh·∫≠n!");
        }
    });

    // t·ª± ƒë·ªông ƒëi·ªÅn t√°c gi·∫£, th·ªÉ lo·∫°i khi ch·ªçn s√°ch
    function fillBookDetails(selectElement) {
        // L·∫•y th√¥ng tin t·ª´ option ƒë∆∞·ª£c ch·ªçn
        var selectedOption = selectElement.options[selectElement.selectedIndex];

        // L·∫•y genre v√† author t·ª´ thu·ªôc t√≠nh data
        var genres = selectedOption.getAttribute('data-genre');
        var authors = selectedOption.getAttribute('data-author');

        // ƒêi·ªÅn th√¥ng tin v√†o c√°c tr∆∞·ªùng genre v√† author
        var genreField = selectElement.closest('tr').querySelector('input[name="genre"]');
        var authorField = selectElement.closest('tr').querySelector('input[name="author"]');

        genreField.value = genres;
        authorField.value = authors;
    }
</script>